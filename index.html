<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عسل الأطفال: طاقة وذكاء ونمو صحي</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        :root {
            --primary-color: #ff914d;
            --secondary-color: #ffb74d;
            --dark-color: #1a4d29;
            --light-color: #f0f8f0;
            --button-dark-color: #4a6c4c;
            --font-family: 'Cairo', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            line-height: 1.6;
            background-color: #FFF8E1;
            color: var(--dark-color);
        }

        .container {
            max-width: 1100px;
            margin: auto;
            overflow: hidden;
            padding: 0 15px;
        }

        header {
            background: linear-gradient(135deg, var(--dark-color), #2f693e);
            color: white;
            padding: 30px 0;
            text-align: center;
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        header p {
            font-size: 1rem;
            max-width: 700px;
            margin: auto;
        }

        .offers-section {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .offer-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            flex: 1 1 30%;
            max-width: 350px;
            border: 3px solid transparent;
        }
        
        .offer-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .offer-item.selected {
            border: 3px solid var(--primary-color);
        }
        
        @media (max-width: 767px) {
            .offers-section {
                flex-direction: column;
            }
            .offer-item {
                width: 100%;
                max-width: none;
            }
        }

        .offer-item img {
            width: 100%;
            height: auto;
            max-width: 800px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .offer-item h3 {
            color: var(--dark-color);
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .offer-item p {
            font-size: 0.9rem;
            color: #555;
        }

        .offer-item p.highlight {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 5px;
        }
        
        .offer-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .offer-btn {
            background: #fff;
            color: var(--dark-color);
            border: 2px solid var(--button-dark-color);
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        .offer-btn.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .offer-btn:hover {
            background: var(--button-dark-color);
            color: white;
        }
        
        .cta-container {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .cta-button {
            display: inline-block;
            background: #FF5722;
            color: white;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
        }

        .cta-button:hover {
            background: #FF7043;
            transform: scale(1.08);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        }

        section {
            padding: 30px 0;
        }

        .section-title {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--dark-color);
            position: relative;
        }

        .section-title::after {
            content: '';
            width: 60px;
            height: 3px;
            background: var(--primary-color);
            display: block;
            margin: 8px auto 0;
            border-radius: 2px;
        }
        
        .hero {
            padding-bottom: 20px;
        }

        .hero-image {
            display: flex;
            justify-content: center;
            padding: 15px 0;
        }
        
        .hero-image img {
            width: 100%;
            height: auto;
            max-width: 600px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .testimonials {
            background-color: #f9f9f9;
        }

        .testimonial-card {
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            margin-bottom: 15px;
        }

        .testimonial-card p {
            font-style: italic;
            font-size: 1rem;
            margin-bottom: 10px;
            color: #555;
        }

        .testimonial-card .author {
            font-weight: bold;
            color: var(--dark-color);
        }

        .faq {
            background-color: #FFF8E1;
        }

        .faq-item {
            margin-bottom: 15px;
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            cursor: pointer;
        }
        
        .faq-question {
            font-weight: bold;
            font-size: 1rem;
            color: var(--dark-color);
            position: relative;
            padding-left: 25px;
        }
        
        .faq-question::before {
            content: '+';
            font-size: 1.2rem;
            font-weight: bold;
            position: absolute;
            left: 0;
            color: var(--primary-color);
            transition: transform 0.3s ease;
        }
        
        .faq-question.active::before {
            content: '-';
            transform: rotate(180deg);
        }

        .faq-answer {
            display: none;
            padding-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .faq-answer.active {
            display: block;
        }

        .benefits .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .benefit-card {
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-align: center;
        }
        .benefit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        .benefit-card h3 {
            color: var(--dark-color);
            margin-bottom: 8px;
            font-size: 1.3rem;
        }
        .benefit-card p {
            font-size: 0.9rem;
            color: #4a6c4c;
        }
        
        .ingredients {
            background-color: #FFF8E1;
        }
        .ingredient-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        .ingredient-item:nth-child(even) {
            flex-direction: column;
        }
        .ingredient-image {
            flex: 1;
            max-width: 90%;
        }
        
        .ingredient-text {
            flex: 2;
        }
        .ingredient-text h3 {
            font-size: 1.6rem;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        .ingredient-text p {
            font-size: 0.9rem;
            color: var(--dark-color);
        }

        .usage .container {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        .usage ul {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .usage li {
            font-size: 0.9rem;
            color: var(--dark-color);
            position: relative;
            padding-right: 20px;
        }
        .usage li::before {
            content: '✓';
            color: var(--button-dark-color);
            font-weight: bold;
            position: absolute;
            right: 0;
            font-size: 1rem;
        }
        
        .order-form {
            background-color: #FFF8E1;
            color: var(--dark-color);
            padding: 30px 0;
            text-align: center;
        }
        .order-form .form-box {
            background: white;
            color: var(--dark-color);
            padding: 20px;
            border-radius: 15px;
            max-width: 90%;
            margin: auto;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        .order-form .form-box h2 {
            color: var(--dark-color);
            margin-bottom: 10px;
        }
        .order-form form input,
        .order-form form select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--button-dark-color);
            border-radius: 8px;
            font-size: 0.8rem;
            font-family: var(--font-family);
            color: var(--dark-color);
        }
        .order-form form button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            animation: pulse-button 2s infinite;
        }
        .order-form form button:hover {
            background: var(--secondary-color);
        }
        
        @keyframes pulse-button {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.7);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(255, 87, 34, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 87, 34, 0);
            }
        }

        .order-summary {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            text-align: right;
            border: 1px dashed #ccc;
        }

        .order-summary h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .order-summary p {
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-summary p span.price {
            font-weight: bold;
            color: var(--primary-color);
            direction: ltr;
        }

        .order-summary p.total {
            border-top: 2px solid #ddd;
            padding-top: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        footer {
            text-align: center;
            padding: 15px 0;
            background: var(--dark-color);
            color: white;
            font-size: 0.8rem;
        }

        @media (min-width: 768px) {
            .hero .container {
                flex-direction: row-reverse;
                text-align: right;
            }
            .benefits .container {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            .ingredient-item {
                flex-direction: row;
                text-align: right;
            }
            .ingredient-item:nth-child(even) {
                flex-direction: row-reverse;
            }
            .testimonial-card {
                margin: 0 10px;
            }
            .testimonials .container {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: 15px;
            }
            .offers-section {
                flex-wrap: nowrap;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>عسل الأطفال: طاقة وذكاء ونمو صحي</h1>
            <p>وداعاً للحلويات الضارة! امنح طفلك هدية الطبيعة... مذاق حلو وفوائد عظيمة.</p>
        </div>
    </header>

    <section class="offers">
        <div class="container">
            <h2 class="section-title">اختر العرض الذي يناسبك</h2>
            <div class="offers-section">
                <div class="offer-item selected" data-offer="single">
                    <img src="https://i.imgur.com/gK65j8s.png" alt="عبوة واحدة من المنتج">
                    <h3>عبوة واحدة</h3>
                    <p>بسعر 215 ألف</p>
                </div>
                <div class="offer-item" data-offer="double">
                    <img src="https://i.imgur.com/6S3lS74.png" alt="عبوتين من المنتج">
                    <h3>عبوتان</h3>
                    <p>وخذ 125غ مجاناً</p>
                    <p class="highlight">**اطلب عبوتين واحصل على عبوة 125 غرام مجاناً.**</p>
                </div>
                <div class="offer-item" data-offer="triple">
                    <img src="https://i.imgur.com/gK65j8s.png" alt="ثلاث عبوات من المنتج">
                    <h3>اشترِ ثلاثة</h3>
                    <p>وخذ واحدة مجاناً</p>
                </div>
            </div>
            
            <div class="offer-buttons">
                <button class="offer-btn selected" data-offer="single">العبوة الأولى</button>
                <button class="offer-btn" data-offer="double">العرض الثاني</button>
                <button class="offer-btn" data-offer="triple">العرض الثالث</button>
            </div>
        </div>
    </section>

    <section class="order-form" id="order">
        <div class="container">
            <h2 class="section-title" style="color: var(--dark-color);">للطلب اكتب معلوماتك في الخانات</h2>
            <div class="form-box">
                <p style="color: var(--dark-color);">اطلب الآن واستفد من العرض المحدود!</p>
                
               <!-- RIGHT: form + cart -->
    <aside class="card" id="formCard">
      <h3 style="margin-top:0">للطلب اكتب معلوماتك أسفله</h3>
      <div class="field">
        <label>العرض المختار</label>
        <select id="offerSelect" aria-label="اختر العرض" onchange="offerSelectChanged()">
          <option value="1">عبوة واحدة — 2800 دج</option>
          <option value="2">عبوتين — 5600 دج (توصيل مجاني)</option>
          <option value="3">3 عبوات + 1 هدية — 8400 دج (توصيل مجاني)</option>
        </select>
      </div>

      <form id="orderForm">
        <div class="field">
          <label>الاسم الكامل</label>
          <input id="name" name="name" type="text" placeholder="الاسم الكامل" required>
        </div>

        <div class="field">
          <label>رقم الهاتف</label>
          <input id="phone" name="phone" type="tel" placeholder="07XXXXXXXX" pattern="[0-9]{10}" required>
        </div>

        <div class="field">
          <label>الولاية</label>
          <select id="wilaya" name="wilaya" required>
            <option value="">اختر ولايتك</option>
            <option>الجزائر</option><option>البليدة</option><option>بومرداس</option><option>تيبازة</option>
            <option>تيزي وزو</option><option>البويرة</option><option>المدية</option><option>عين الدفلى</option>
            <option>الشلف</option><option>وهران</option><option>مستغانم</option><option>معسكر</option>
            <option>غليزان</option><option>سيدي بلعباس</option><option>تلمسان</option><option>سعيدة</option>
            <option>تيارت</option><option>تيسمسيلت</option><option>الجلفة</option><option>الأغواط</option>
            <option>برج بوعريريج</option><option>سطيف</option><option>باتنة</option><option>قسنطينة</option>
            <option>أم البواقي</option><option>قالمة</option><option>سوق أهراس</option><option>عنابة</option>
            <option>الطارف</option><option>خنشلة</option><option>تبسة</option><option>المسيلة</option>
            <option>بجاية</option><option>جيجل</option><option>ميلة</option><option>بسكرة</option>
            <option>الوادي</option><option>ورقلة</option><option>غرداية</option><option>البيض</option>
            <option>النعامة</option><option>أدرار</option><option>تمنراست</option><option>إيليزي</option>
            <option>جانت</option><option>إن صالح</option><option>برج باجي مختار</option>
          </select>
        </div>

        <!-- hidden fields -->
        <input type="hidden" id="offerField" name="offer" value="عبوة واحدة — 2800">
        <input type="hidden" id="price_items" name="price_items" value="2800">
        <input type="hidden" id="price_cart" name="price_cart" value="0">
        <input type="hidden" id="price_shipping" name="price_shipping" value="0">
        <input type="hidden" id="total_price" name="total" value="2800">

        <!-- summary -->
        <div class="summary">
          <div class="row"><div>سعر العبوات:</div><div id="ui_price_items">2800 دج</div></div>
          <div class="row"><div>سعر السلة:</div><div id="ui_price_cart">0 دج</div></div>
          <div class="row"><div>سعر التوصيل:</div><div id="ui_price_shipping">0 دج</div></div>
          <div class="row total"><div>المجموع الكلي:</div><div id="ui_total">2800 دج</div></div>
        </div>

        <button type="submit" class="confirm">✅ تأكيد الطلب الآن</button>
      </form>

      <!-- cart -->
      <div class="cart" id="cartBox">
        <strong>سلة المشتريات</strong>
        <div id="cartList" style="margin-top:8px;color:var(--muted)">السلة فارغة — أضف منتجات إضافية من الأسفل</div>
      </div>

      <!-- UPSSELLS -->
      <div class="upsells">
        <div class="upsell">
          <img src="upsell-kids.jpg" alt="">
          <div style="margin-top:8px;font-weight:700">خلطة التبول اللاارادي عند الأطفال</div>
          <div class="small">3200 دج</div>
          <button onclick="addToCart('خلطة التبول اللاارادي عند الاطفال',3200)">أضف للسلة</button>
        </div>
        <div class="upsell">
          <img src="upsell-men.jpg" alt="">
          <div style="margin-top:8px;font-weight:700">خلطة القوة الجنسية للرجال</div>
          <div class="small">3500 دج</div>
          <button onclick="addToCart('خلطة القوة الجنسية للرجال',3500)">أضف للسلة</button>
        </div>
        <div class="upsell">
          <img src="upsell-weight.jpg" alt="">
          <div style="margin-top:8px;font-weight:700">خلطة التسمين الطبيعي</div>
          <div class="small">3000 دج</div>
          <button onclick="addToCart('خلطة التسمين الطبيعي',3000)">أضف للسلة</button>
        </div>
        <div class="upsell">
          <img src="upsell-cough.jpg" alt="">
          <div style="margin-top:8px;font-weight:700">خلطة السعال والبلغم</div>
          <div class="small">2800 دج</div>
          <button onclick="addToCart('خلطة السعال والبلغم',2800)">أضف للسلة</button>
        </div>
        <div class="upsell">
          <img src="upsell-flower.jpg" alt="">
          <div style="margin-top:8px;font-weight:700">عسل الأزهار (250غ)</div>
          <div class="small">2200 دج</div>
          <button onclick="addToCart('عسل الازهار',2200)">أضف للسلة</button>
        </div>
        <div class="upsell">
          <img src="upsell-sidr.jpg" alt="">
          <div style="margin-top:8px;font-weight:700">عسل السدر (250غ)</div>
          <div class="small">4200 دج</div>
          <button onclick="addToCart('عسل السدر',4200)">أضف للسلة</button>
        </div>
      </div>

    </aside>
  </div>

  <div class="footer">
    <div>سياسة الإرجاع: استرجاع خلال 7 أيام عند وجود تلف أو عدم مطابقة.</div>
    <div style="margin-top:8px">© 2025 مناحل وعسل آل البوسعيدي — جميع الحقوق محفوظة</div>
  </div>
</div>

<button class="sticky-order" onclick="goToName()">🛒 اطلب الآن</button>

<script>
/* ==== ضع رابط Web App هنا (رابط /exec من Google Apps Script) ==== */
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwgRZm4ppj_HRz-gaDf4UKg-9aN7bYots2xEGsoQPQ2eno_dK0NHsNIwGZg7wriI6YULQ/exec";
/* ==== ثابت السعر وقائمة الشحن حسب الولاية ==== */
const UNIT_PRICE = 2800;
const shippingTable = { "الجزائر":400,"البليدة":400,"بومرداس":400,"تيبازة":400,"تيزي وزو":700,"البويرة":700,"المدية":700,"عين الدفلى":700,"الشلف":700,"وهران":800,"مستغانم":800,"معسكر":800,"غليزان":800,"سيدي بلعباس":800,"تلمسان":900,"سعيدة":900,"تيارت":900,"تيسمسيلت":900,"الجلفة":900,"الأغواط":900,"برج بوعريريج":900,"سطيف":900,"باتنة":900,"قسنطينة":1000,"أم البواقي":1000,"قالمة":1000,"سوق أهراس":1000,"عنابة":1000,"الطارف":1000,"خنشلة":1000,"تبسة":1000,"المسيلة":1000,"بجاية":1000,"جيجل":1000,"ميلة":1000,"بسكرة":1100,"الوادي":1100,"ورقلة":1100,"غرداية":1100,"البيض":1100,"النعامة":1300,"أدرار":1300,"تمنراست":1300,"إيليزي":1300,"جانت":1300,"إن صالح":1300,"برج باجي مختار":1300 };

/* ==== حالة السلة والعروض ==== */
let cart = [];
const offerCards = document.querySelectorAll('.offer-card');
const offerSelect = document.getElementById('offerSelect');
const ui_price_items = document.getElementById('ui_price_items');
const ui_price_cart = document.getElementById('ui_price_cart');
const ui_price_shipping = document.getElementById('ui_price_shipping');
const ui_total = document.getElementById('ui_total');

/* ===== functions ===== */
function selectOfferCard(el){
  offerCards.forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  const offer = el.getAttribute('data-offer');
  const price = parseInt(el.getAttribute('data-price')) || UNIT_PRICE;
  // Update select and hidden fields
  document.getElementById('offerSelect').value = offer;
  document.getElementById('offerField').value = (offer==='1' ? 'عبوة واحدة — 2800' : (offer==='2' ? 'عبوتين — 5600' : '3 عبوات + 1 — 8400'));
  document.getElementById('price_items').value = price;
  computePrices();
  document.getElementById('formCard').scrollIntoView({behavior:'smooth',block:'center'});
}

function offerSelectChanged(){
  const v = document.getElementById('offerSelect').value;
  // map select values to price & active card
  const map = { "1":2800, "2":5600, "3":8400 };
  const price = map[v] || UNIT_PRICE;
  document.getElementById('price_items').value = price;
  // sync cards
  offerCards.forEach(c => { if(c.getAttribute('data-offer')===v) c.classList.add('active'); else c.classList.remove('active'); });
  document.getElementById('offerField').value = (v==='1' ? 'عبوة واحدة — 2800' : (v==='2' ? 'عبوتين — 5600' : '3 عبوات + 1 — 8400'));
  computePrices();
}

function addToCart(name, price){
  const idx = cart.findIndex(i=>i.name===name);
  if(idx>-1) cart[idx].qty += 1; else cart.push({name, price, qty:1});
  renderCart(); computePrices();
}

function changeQty(i,delta){ cart[i].qty = Math.max(1, cart[i].qty + delta); renderCart(); computePrices(); }
function removeFromCart(i){ cart.splice(i,1); renderCart(); computePrices(); }

function renderCart(){
  const el = document.getElementById('cartList');
  if(!cart.length){ el.innerHTML = '<div class="small">السلة فارغة — أضف منتجات إضافية</div>'; document.getElementById('price_cart').value = 0; ui_price_cart.textContent = '0 دج'; return; }
  el.innerHTML = '';
  cart.forEach((it, idx)=>{
    const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.marginBottom='8px';
    row.innerHTML = `<div><strong>${it.name}</strong><div class="small">${it.price} دج × ${it.qty}</div></div>
      <div style="display:flex;gap:8px;align-items:center">
        <button onclick="changeQty(${idx},-1)">−</button>
        <button onclick="changeQty(${idx},1)">+</button>
        <button onclick="removeFromCart(${idx})" style="background:#ff6b6b;color:#fff;border-radius:6px;padding:6px 8px;border:0">حذف</button>
      </div>`;
    el.appendChild(row);
  });
}

/* حساب الأسعار */
function computePrices(){
  const offerText = document.getElementById('offerField').value || 'عبوة واحدة — 2800';
  const priceItems = parseInt(document.getElementById('price_items').value) || UNIT_PRICE;
  const cartSum = cart.reduce((s,i)=> s + i.price * i.qty, 0);
  const wilaya = document.getElementById('wilaya').value;
  let shipping = shippingTable[wilaya] || 0;
  // قواعد: عروض 2 و 3 شحن مجاني
  if(offerText.includes('عبوتين') || offerText.includes('3 عبوات')) shipping = 0;
  const total = priceItems + cartSum + shipping;
  ui_price_items.textContent = priceItems + ' دج';
  ui_price_cart.textContent = cartSum + ' دج';
  ui_price_shipping.textContent = (shipping===0 ? 'مجاني' : shipping + ' دج');
  ui_total.textContent = total + ' دج';
  // hidden inputs
  document.getElementById('price_items').value = priceItems;
  document.getElementById('price_cart').value = cartSum;
  document.getElementById('price_shipping').value = shipping;
  document.getElementById('total_price').value = total;
  return {priceItems, cartSum, shipping, total};
}

/* انتقال إلى الخانة الاسم */
function goToName(){ document.getElementById('name').scrollIntoView({behavior:'smooth',block:'center'}); document.getElementById('name').focus(); }

/* init hidden inputs if not present */
document.addEventListener('DOMContentLoaded', function(){
  if(!document.getElementById('offerField')){ const inp=document.createElement('input'); inp.type='hidden'; inp.id='offerField'; inp.name='offer'; inp.value='عبوة واحدة — 2800'; document.getElementById('orderForm').appendChild(inp); }
  if(!document.getElementById('price_items')){ const x=document.createElement('input'); x.type='hidden'; x.id='price_items'; x.name='price_items'; x.value=2800; document.getElementById('orderForm').appendChild(x); }
  if(!document.getElementById('price_cart')){ const x=document.createElement('input'); x.type='hidden'; x.id='price_cart'; x.name='price_cart'; x.value=0; document.getElementById('orderForm').appendChild(x); }
  if(!document.getElementById('price_shipping')){ const x=document.createElement('input'); x.type='hidden'; x.id='price_shipping'; x.name='price_shipping'; x.value=0; document.getElementById('orderForm').appendChild(x); }
  if(!document.getElementById('total_price')){ const x=document.createElement('input'); x.type='hidden'; x.id='total_price'; x.name='total'; x.value=2800; document.getElementById('orderForm').appendChild(x); }
  computePrices();
});

/* إرسال الفورم عبر fetch إلى Google Apps Script */
document.getElementById('orderForm').addEventListener('submit', function(e){
  e.preventDefault();
  // validate phone
  const phone = document.getElementById('phone').value.trim();
  if(!/^[0-9]{10}$/.test(phone)){ alert('رجاءً أدخل رقم هاتف صالح مكوّن من 10 أرقام'); document.getElementById('phone').focus(); return; }
  // build FormData
  const fd = new FormData();
  fd.append('name', document.getElementById('name').value.trim());
  fd.append('phone', phone);
  fd.append('wilaya', document.getElementById('wilaya').value);
  fd.append('offer', document.getElementById('offerField').value);
  fd.append('price_items', document.getElementById('price_items').value);
  fd.append('price_cart', document.getElementById('price_cart').value);
  fd.append('price_shipping', document.getElementById('price_shipping').value);
  fd.append('total', document.getElementById('total_price').value);
  // include cart items as upsell[]
  cart.forEach(item => fd.append('upsell[]', `${item.name} x${item.qty} (${item.price} دج)`));
  // send
  if(!WEBAPP_URL || WEBAPP_URL.includes("PUT_YOUR_WEBAPP_URL_HERE")){ alert('خطأ: لم تقم بإعداد رابط Web App. افتح الكود وعيّن WEBAPP_URL.'); return; }
  fetch(WEBAPP_URL, { method: 'POST', body: fd })
    .then(r => r.json())
    .then(res => {
      if(res.result === 'success'){ cart=[]; renderCart(); computePrices(); window.location.href = "thankyou.html"; }
      else { alert('خطأ في الإرسال: ' + (res.message||'')); }
    })
    .catch(err => { console.error(err); alert('حدث خطأ أثناء الإرسال. تأكد من رابط Web App وأنه منشور (Who has access = Tout le monde).'); });
});
</script>
</body>
</html>
